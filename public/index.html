<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRIP Production Logger</title>
    <style>
        /* Copy the styles from the artifact above */
    </style>
</head>
<body>
    <!-- Copy the HTML body from the artifact above -->
    
    <script>
        // API URL - Railway will give you this
        const API_URL = window.location.origin;
        
        let dailyTotals = {
            goodParts: 0,
            rejects: 0,
            blades: 0,
            steelFeet: 0
        };
        
        async function processEngelPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('photo', file);
            formData.append('operator', getOperatorName());
            
            try {
                const response = await fetch(`${API_URL}/api/engel/capture`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('engelGood').textContent = result.data.good_parts + ' pcs';
                    document.getElementById('engelScrap').textContent = result.data.scrap_parts + ' pcs';
                    document.getElementById('engelRejects').textContent = result.data.reject_parts + ' pcs';
                    document.getElementById('engelTotal').textContent = result.data.total_parts + ' pcs';
                    
                    updateDailyTotals();
                    alert('✅ Data saved to database!');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function processCoilPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('photo', file);
            formData.append('operator', getOperatorName());
            
            try {
                const response = await fetch(`${API_URL}/api/blade/capture`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('coilCount').textContent = result.data.coil_count + ' coils';
                    document.getElementById('coilLength').textContent = result.data.total_length + ' ft';
                    document.getElementById('bladeCount').textContent = '~' + result.data.estimated_blades;
                    
                    updateDailyTotals();
                    alert('✅ Coil data saved!');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function updateDailyTotals() {
            try {
                const response = await fetch(`${API_URL}/api/summary/today`);
                const summary = await response.json();
                
                document.getElementById('todayGood').textContent = summary.production.total_good || 0;
                document.getElementById('todayRejects').textContent = summary.production.total_rejects || 0;
                document.getElementById('todayBlades').textContent = summary.blade.total_blades || 0;
                document.getElementById('steelUsed').textContent = summary.blade.total_steel || 0;
            } catch (error) {
                console.error('Error fetching summary:', error);
            }
        }
        
        function getOperatorName() {
            let operator = localStorage.getItem('operator');
            if (!operator) {
                operator = prompt('Enter your name:');
                if (operator) {
                    localStorage.setItem('operator', operator);
                }
            }
            return operator || 'Unknown';
        }
        
        // Load totals on startup
        window.addEventListener('load', updateDailyTotals);
    </script>
</body>
</html>